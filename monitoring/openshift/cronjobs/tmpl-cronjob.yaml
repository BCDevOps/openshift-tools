- kind: "CronJob"
  apiVersion: "batch/v1beta1"
  metadata:
    name: "${JOB_NAME}"
    namespace: ${NAMESPACE}
    labels:
      template: "ops-cronjob"
      cronjob: "${JOB_NAME}"
  spec:
    schedule: "${SCHEDULE}"
    concurrencyPolicy: "Forbid"
    successfulJobsHistoryLimit: "${{SUCCESS_JOBS_HISTORY_LIMIT}}"
    failedJobsHistoryLimit: "${{FAILED_JOBS_HISTORY_LIMIT}}"
    jobTemplate:
      metadata:
        labels:
          template: "ops-cronjob"
          cronjob: "${JOB_NAME}"
      spec:
        backoffLimit: ${JOB_BACKOFF_LIMIT}
        template:
          spec:
            containers:
              - name: "${JOB_NAME}"
                image: "openshift3/ose"
                command:
                  - "/bin/bash"
                  - "-c"
                  - "source /etc/config/${JOB_SOURCE_SCRIPT} || :"
                volumeMounts:
                  - mountPath: "/etc/config"
                    name: "job-cm-script"
                  - mountPath: "/mnt"
                    name: "cronjob-log-volume"
            volumes:
              - name: job-cm-script
                configMap:
                  items:
                    - key: ${JOB_SOURCE_SCRIPT}
                      path: ${JOB_SOURCE_SCRIPT}
                  name: ${JOB_SOURCE_SCRIPT}
              - name: cronjob-log-volume
                persistentVolumeClaim:
                  claimName: "${JOB_PERSISTENT_STORAGE_NAME}"
            restartPolicy: "Never"
            terminationGracePeriodSeconds: 30
            activeDeadlineSeconds: 1600
            dnsPolicy: "ClusterFirst"
            serviceAccountName: "${JOB_SERVICE_ACCOUNT}"
            serviceAccount: "${JOB_SERVICE_ACCOUNT}"
